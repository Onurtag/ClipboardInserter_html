<html>

<head>
    <meta charset="utf-8">
    <title>Clipboard Inserter HTML Enhanced</title>
    <!-- scary base64 encoded favicon (小)-->
    <link href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAC90lEQVQ4jU2SW2tVRxTH19z23uca05zEJEZzDpEmNbXeQCoqIiheCkUE8+IX8M2nfoJ+gD4UCnkqtEie+tiAlQZFRMUgCW3qJTHectMk5mSffc6evWdmTdnHfQ4ZWDDMrPn91//PkL6Fhw4A8LREWiwpPXH7JD0yPEdHylUAMACgAUCllew1TZuTxwnIBYAMAOTMH1Nn1aPZcf3rn9N2cbkXALIA4KU9LVFGdyg76eMsNyYPq5un5NpagRAi3P4SaZ59hrQAzUl5OkFL3dO/T45B1os5pwmsudzFpXL13swFcv74BN2/dyk9tomtneqe/m3ymrz/5AfqOHbXoeHbLcDWrb9+ri3Md+dW1k87P94YAwBMM1FtC24Ue7QeDip/O0OFAEGI1wJQziL1YRVMrdYHkw9Ocq3bwbdDdJRycWX9TNLIvGyWgXVbgP6Dlan86DdhY2E+Z2ZejDGDIgVQ2hTQmmfrYcYqrEAcAWekym3TWnMNVPreusUi6pX3gNvhCfF6+QsAIEmlAEODv5+c0X415L390NlVeEWtpS2AUIqXSh3PRHkIwtUlG01Nf5+REWvaS9JkxpDw1fK5xrs3mUJlSO4r9z4l1tp2Bmj14GD3dLE8JOW7N0IurV8WSiX3TRXLHv87IP3GsWREJhzc1dPx1qJVLYAlpNHVVVwkwuG48REQYaj0YYN5MrK0ENStnX8/jEGA2a8P656O7AxDbFjEHQDwAcAveWyu+7ur6uLonuu7N6s2IyPkRT/AL78auDe7tnn/U6N46sRI/0QDMQSDcduCMQlAXTqw56dEUKPaWNn2sVALNO+s+ti55eOVctcvFHFii0B05+4/N2tSfxvNzUK+sh+E1gEQCJFSh6IFrk09Vw+VGyvDPRlpL4ripMkwZg3jkjG6UXv5H9BSz+evLON6UMxXg3wO3FgRS6AmPbeeTMUNY7F0XZ9pQ5FSP3IFHq30jEfB8CgHYB2CPM+HYfCp1Lm9trsUK8EtsVZGjhNGjtD/Awy3cVQ9IGG0AAAAAElFTkSuQmCC" rel="icon" type="image/png" />
    <!-- 
/////////////////////////////////////////////////////////////////////
//////// Downloadable HTML for Clipboard Inserter (Enhanced) ////////
/////////////////////////////////////////////////////////////////////

❗❗❗❗❗ Non-default Clipboard Inserter settings are required:
- element name: pre
- container selector: #textlines

If you append #largemode to the url of this page (bookmark it if you want), it will switch to large mode with bigger margins and buttons.

Hover the buttons to read their descriptions.
Both appending and prepending should work for all buttons/functions. (if you have a modified ClipboardInserter)


Don't expect any support unless its a bug. Mod it yourself if you need small changes.

Original page was inspired/borrowed from: https://pastebin.com/raw/HxjV6YrB (Only a few lines of the old code left) 
Which was found here: https://pastebin.com/gNJfqpmN

/////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////// 
-->


    <!------------------------
    (Old readme, 
     should be useful if you are new and want to modify the css.)

To change background color or text color, just replace the style values above with the hex values for the colors you want.
If you want the background of the counter to remain semi-transparent, you must use rgb values like above. The last number (where I've put 0.8) is the opacity level (1.0 = completely opaque).
To change font size, just change the em value to what works for you (the standard size is 1, I like it at 1.5).
To change font weight (boldness), just edit the value above.  100 is quite thin, 400 is default, 900 is quite thick.  You may want it higher than default for Mincho fonts.
The line-height value changes the spacing between lines.

To use the font of your choice, remove the list of fonts above and put the ENGLISH name of your font in quotation marks (some JP font names are in Japanese).
Be sure to leave a semi-colon at the end of the line.
To find the English name of a given font, first install it, then open Firefox.
Go to about:preferences#content in the address bar, then click on the 'Default font' drop-down menu.
The "correct" name of your font will be listed here - just copy that down and paste it up above.

Note that if you would like to use your browser default font, replace the font-family line with font-family:""; or delete it altogether.
Your default is probably Gothic - if you want to try out a good Mincho font, try Aozora Mincho at http://www.freejapanesefont.com/aozora-mincho-download/
For various other free Japanese fonts, visit http://www.freejapanesefont.com/
For more font attribute information visit http://www.w3schools.com/css/css_font.asp

------------------------>
    <style id="maincss" type="text/css">
        /* TODO: clean up css, refactor old rules to use correct methods, don't use scale, check for chrome compatibility after the previous points are done */

        /* prevent top right buttons from moving */
        html {
            overflow-y: scroll;
            scrollbar-width: thin;
        }

        body {
            background-color: #202020;
            color: #BCBCBC;
            font-size: 1.3em;
            font-weight: 400;
            line-height: 150%;
            margin-top: 5%;
            margin-left: 15%;
            margin-right: 15%;
            margin-bottom: 420px;
            font-family: "MS Gothic", "Meiryo";
            /* font-family: "IPAGothic", "Sazanami Gothic", "Kochi Gothic", "VL Gothic", "Ume Gothic", "Pro W3", "Hiragino Kaku Gothic Pro", "Osaka Mono", "Osaka", "MS Gothic", "Meiryo", "M+ 1m"; */
        }

        /* Main text style is here */
        pre {
            /* You can pick some other fonts from below as well. Most fonts use MS Gothic for Japanese text (like Segoe UI here) which is the default japanese font for many games and other media. */
            /*font-family: "IPAGothic", "Sazanami Gothic", "Kochi Gothic", "VL Gothic", "Ume Gothic", "Pro W3", "Hiragino Kaku Gothic Pro", "Osaka Mono", "Osaka", "MS Gothic", "Meiryo", "M+ 1m";*/
            /* font-family: "Segoe UI"; */
            font-family: "Noto Sans JP Light";
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0em 0em 0em 0em;
            padding-bottom: 0px;
        }

        #textlines>pre {
            border-bottom: #414141 solid 1px;
            padding-bottom: 1.4em;
            margin-bottom: 0.46em;
        }

        /* Top right button css are a bit of a mess right now: #toprightbuttons, .buttoncontainer, #counter, .countercontainer */
        .buttoncontainer {
            /* Set this to position: absolute; if you want to disable the fixed buttons on top right */
            position: fixed;
            top: 0px;
            right: 10px;
            display: inline-block;
            font-size: 1.4em;
            font-family: "VL Gothic";
            user-select: none;
            z-index: 1;
        }

        #toprightbuttons:hover,
        #menucontainer:hover~#toprightbuttons {
            display: inline-block !important;
        }

        #toprightbuttons {
            right: 150px;
            display: none;
            /* background: #202020; */
        }

        body.verticalmode {
            margin-right: 28px;
        }

        #toprightbuttons.verticalmode {
            right: -5px;
            top: 40px;
            width: 50px;
        }

        #toprightbuttons.verticalmode>div {
            padding-left: 8px !important;
            padding-right: 8px !important;
            margin-bottom: 6px !important;
        }

        #toprightbuttons.verticalmode>#clear_button {
            line-height: 136%;
            padding-right: 9px !important;
            padding-left: 9px !important;
        }

        #toprightbuttons.verticalmode>#edit_button {
            line-height: 130%;
        }

        #toprightbuttons.verticalmode>#undo_button,
        #toprightbuttons.verticalmode>#redo_button {
            border-radius: 6px !important;
            font-size: 26px;
            padding-right: 9px !important;
            margin-bottom: 0px !important;
        }

        #toprightbuttons.verticalmode>#scroll_button {
            font-size: 20px;
            padding-right: 7px !important;
            line-height: 115%;
        }

        .countercontainer {
            position: fixed;
            bottom: 1px;
            right: 1px;
            display: inline-block;
            font-size: 1.4em;
            user-select: none;
        }

        .buttoncontainer>div:not(#counter):hover {
            /* filter: brightness(130%);
            background-color: rgba(22, 22, 22, 1.0); */
            color: #d7d7d7;
        }

        .buttoncontainer>#pin_button:hover {
            filter: brightness(130%) grayscale(100%);
            background-color: rgba(22, 22, 22, 1.0);
        }

        .buttoncontainer>div,
        .countercontainer>div {
            border-radius: 6px !important;
        }

        #counter {
            background-color: rgba(25, 25, 25, 0.6);
            color: #9d9d9d;
            font-size: 16px;
            line-height: 100%;
            float: left;
            padding-left: 8px;
            padding-right: 8px;
            padding-top: 6px;
            padding-bottom: 7px;
            font-family: "Calibri";
        }

        #clear_button {
            background-color: rgba(25, 25, 25, 0.6);
            color: #9d9d9d;
            font-size: 17px;
            line-height: 100%;
            float: left;
            margin-right: 8px;
            padding-left: 8px;
            padding-right: 7px;
            padding-top: 6px;
            padding-bottom: 7px;
            cursor: pointer;
            font-family: "Noto Sans JP Light", "Arial";
        }

        #pin_button {
            background-color: rgba(25, 25, 25, 0.6);
            color: #9d9d9d;
            font-size: 15px;
            line-height: 100%;
            float: left;
            padding-left: 6px;
            padding-right: 4px;
            padding-top: 5px;
            padding-bottom: 10px;
            margin-right: 9px;
            cursor: pointer;
            filter: grayscale(100%);
            font-family: "Noto Sans JP Light", "Arial";
        }

        .undoredoButtons {
            background-color: rgba(25, 25, 25, 0.6);
            color: #9d9d9d;
            font-size: 22px;
            line-height: 100%;
            float: left;
            margin-right: 8px;
            padding-left: 8px;
            padding-right: 8px;
            padding-top: 5px;
            padding-bottom: 3px;
            cursor: pointer;
            pointer-events: initial;
        }

        .undoredoButtons[disabled] {
            pointer-events: none;
            color: #4e4e4e;
        }

        #undo_button {
            margin-right: 0px;
            padding-right: 8px;
            border-radius: 6px 0px 0px 6px !important;
        }

        #redo_button {
            border-radius: 0px 6px 6px 0px !important;
            padding-left: 4px;
            padding-right: 7px;
        }

        #scroll_button {
            background-color: rgba(25, 25, 25, 0.6);
            color: #a6a6a6;
            font-size: 18px;
            line-height: 100%;
            float: left;
            margin-right: 8px;
            padding-left: 6px;
            padding-right: 6px;
            padding-top: 6px;
            padding-bottom: 7px;
            cursor: pointer;
            /*font-family: "Lucida Sans Unicode";*/
        }

        #edit_button {
            background-color: rgba(25, 25, 25, 0.6);
            color: #9d9d9d;
            font-size: 18px;
            line-height: 100%;
            float: left;
            margin-right: 8px;
            padding-left: 6px;
            padding-right: 6px;
            padding-top: 6px;
            padding-bottom: 6px;
            cursor: pointer;
        }

        .edit_button_on {
            box-shadow: inset 0px 0px 6px 2px rgba(73, 196, 47, 0.5);
            color: rgb(73, 196, 47) !important;
        }

        /* 
        .pin_button_on {
            box-shadow: inset 0px 0px 6px 2px rgba(73, 196, 47, 0.5);
            color: rgb(73, 196, 47) !important;
        } 
        */

        .pin_button_on>#pintext {
            transform: rotate(-45deg) !important;
            margin-right: 2px;
            margin-left: -2px;
        }

        #menu_button {
            background-color: rgba(25, 25, 25, 0.6);
            color: #9d9d9d;
            line-height: 100%;
            float: right;
            font-size: 23px;
            padding-left: 6px;
            padding-right: 6px;
            padding-top: 3px;
            padding-bottom: 4px;
            cursor: pointer;
        }

        #remove_button {
            background-color: rgba(29, 29, 29, 1);
            color: #9d9d9d;
            line-height: 100%;
            float: right;
            font-size: 22px;
            padding-left: 4px;
            padding-right: 5px;
            padding-top: 4px;
            padding-bottom: 4px;
            cursor: pointer;
        }

        #go_to_last_button {
            position: relative;
            bottom: -20px;
            width: 50px;
            cursor: pointer;
            user-select: none;
            font-size: 50px;
            filter: opacity(20%);
        }

        #go_to_last_button:hover {
            filter: opacity(40%);
        }

        #go_bottom_button {
            position: absolute;
            top: 9px;
            width: 50px;
            cursor: pointer;
            user-select: none;
            font-size: 50px;
            filter: opacity(20%);
        }

        #go_bottom_button:hover {
            filter: opacity(40%);
        }

        /* Hover CSS */
        .hoverButtonsContainer:hover,
        pre:hover>.hoverButtonsContainer>.hoverButtonsBackground {
            display: flex !important;
        }

        .hoverButtonsBackground:hover,
        .hoverButtonsBackground:hover>.hoverButtons {
            opacity: 90%;
        }

        .hoverButtonsBackground {
            position: absolute;
            display: flex;
            flex-direction: row;
            justify-content: space-evenly;
            background-color: #1D1D1D;
            padding: 2px 5px 5px 10px;
            border-radius: 10px;
            z-index: 555;
            font-size: 14px;
            margin-left: -6px;
            margin-top: -2px;
            user-select: none;
            display: none;
        }

        .hoverButtonsContainer {
            position: absolute;
            width: 138px;
            height: 30vh;
            display: flex;
            background-color: transparent;
            margin-left: -138px;
            margin-top: 0px;
            user-select: none;
        }

        .hoverButtons {
            cursor: pointer;
            margin-right: 0px;
            color: #adadad;
            opacity: 40%;
        }

        .hoverButtons:hover {
            color: #fff;
        }

        .hoverButtonDelete {
            font-size: 25px;
            line-height: 28px;
            margin-right: 4px;
            margin-top: -1px;
        }

        .hoverButtonDown,
        .hoverButtonUp {
            font-size: 22px;
            font-family: "Lucida Sans Unicode";
        }

        .hoverButtonReduceNewlines {
            font-size: 33px;
            line-height: 22px;
            font-family: Arial;
            margin-top: 4px;
            margin-right: 2px;
        }

        .hoverButtonCopy:hover {
            filter: contrast(170%);
        }

        .hoverButtonCopy {
            font-size: 20px;
            line-height: 22px;
            font-family: Arial;
            margin-top: 4px;
            filter: contrast(90%);
        }

    </style>


    <!-- CSS FOR SMALL PAGE (enabled by default, disabled by appending #largemode to url) -->
    <style id="smallcss" type="text/css">
        body {
            margin-top: 24px;
            margin-left: 2%;
            margin-right: 2%;
            margin-bottom: 420px;
        }

        .buttoncontainer {
            scale: 70%;
            right: -3px;
            top: 0px;
            margin-top: -5px !important;
        }

        #toprightbuttons {
            right: -37px;
            z-index: 3;
        }

        #toprightbuttons.verticalmode {
            right: -16px;
            top: 14px;
            width: 50px;
        }

        .countercontainer {
            /* 
            right: 30px !important;
            top: 5px;
            margin-top: -5px !important;
             */
        }

        #counter {
            font-size: 11px;
            padding-bottom: 5px !important;
            padding-top: 5px !important;
            padding-left: 8px !important;
            padding-right: 7px !important;
            border-radius: 5px !important;
        }

        #go_bottom_button {
            scale: 44%;
            top: -4px !important;
            margin-left: 70px;
        }

        #go_to_last_button {
            scale: 44%;
            margin-left: 70px;
        }

        .hoverButtonsContainer {
            width: 96px !important;
            margin-left: 0px !important;
            margin-top: -20px;
            height: 20px;
        }

        .hoverButtonsBackground {
            scale: 63%;
            margin-left: -26px !important;
            margin-top: -8px;
            border-radius: 10px;
            height: 145%;
        }

        .hoverButtonReduceNewlines {
            font-size: 36px;
            margin-top: 4px;
        }

        .hoverButtonDelete {
            font-size: 27px;
            margin-top: 0px;
        }

    </style>

</head>

<body>
    <div id="go_bottom_button" title="Scroll to the bottom">🡻</div>
    <div id="menucontainer" class="buttoncontainer">
        <!-- This is the div used for the "show menu menu" button. -->
        <div id="menu_button" title="Menu">⚙</div>
    </div>
    <div id="toprightbuttons" class="buttoncontainer" style="display: inline-block !important;">
        <!-- This is the div used for the "Pin menu" button. -->
        <div id="pin_button" class="pin_button_on" title="Pin/Unpin the menu">
            <div id="pintext">📌</div>
        </div>
        <!-- This is the div used for the "Clear all lines" button. -->
        <div id="clear_button" title="Clear all lines">∅</div>
        <!-- This is the div used for the "Toggle scroll to bottom a when new line is added" button. -->
        <div id="scroll_button" title="Scroll to bottom(⇓)/top(⇑)/nowhere(⇕) when a new line is added.">⇓</div>
        <!-- This is the div used for the "Enable editing" button. -->
        <div id="edit_button" title="Enable editing &#013;History is saved right when you enable this, &#013;so disable it if you want when you are done.">🖉</div>
        <!-- These are the divs used for the "Undo/Redo" buttons. -->
        <div id="undo_button" class="undoredoButtons" disabled="" title="Undo">
            <div style="transform: scale(1, -1);top: 2px;position: relative;">⤾</div>
        </div>
        <div id="redo_button" class="undoredoButtons" disabled="" title="Redo">
            <div style="transform: scale(1, -1);top: 2px;position: relative;">⤿</div>
        </div>
        <!-- This is the div used for the "remove last line" button. -->
        <div id="remove_button" title="Remove first/last line &#013;(removes first line instead when auto scroll is set to 'Scroll to top')">✖</div>
    </div>
    <div class="countercontainer">
        <!-- This is the div used for the counter. -->
        <div id="counter" title="No. of characters / No. of lines">0 / 0</div>
    </div>
    <div style="display:none;">
        <!-- Dummy div for buttons-->
    </div>

    <script>
        //javascript stuff
        const historystack = [];
        const maxhistorylength = 1000;
        var historystack_forward = [];
        var editingEnabled = false;
        var pinningEnabled = true;
        var editPinnedButtons = false;
        var scroll_fix_alignment = 10;
        var forgiveHistoryTimes = 0;


        //DOMContentLoaded Start
        document.addEventListener("DOMContentLoaded", function(event) {
            //1: scroll down on newline
            //2: scroll up
            //0: disabled
            var scrollOnNewline = localStorage.getItem("scrollOnNewline");
            switch (scrollOnNewline) {
                case "disabled":
                    document.querySelector("#scroll_button").style.color = "#595959";
                    document.querySelector("#scroll_button").innerText = "⇕";
                    break;
                case "toBottom":
                    document.querySelector("#scroll_button").style.color = "";
                    document.querySelector("#scroll_button").innerText = "⇓";
                    break;
                case "toTop":
                    document.querySelector("#scroll_button").style.color = "";
                    document.querySelector("#scroll_button").innerText = "⇑";
                    break;
                default:
                    scrollOnNewline = "toBottom";
                    break;
            }

            if (document.location.protocol.indexOf("http") == -1) {
                document.title = document.title += " (Local)";
            } else {
                document.title = document.title += " (Online)";
            }

            //Check if #largemode
            if (document.location.hash == "#largemode") {
                scroll_fix_alignment = -16;
                document.querySelector("#smallcss").disabled = true;
            }

            const myMutationObserver = new MutationObserver(function(records) {
                records.forEach(function(mutation) {
                    Array.prototype.forEach.call(mutation.addedNodes, function(node) {
                        try {
                            var isNewLine = false;
                            //return if the inserted node is not in #textlines
                            var relatedId = "";
                            try {
                                if ((node.parentNode.attributes.id.value == "textlines") && (node.tagName == "PRE")) {
                                    isNewLine = true;
                                }
                            } catch (error) {}
                            if (!isNewLine) {
                                return
                            }

                            //push history (delete forward history)
                            if (forgiveHistoryTimes == 0) {
                                historyPush();
                            } else {
                                --forgiveHistoryTimes;
                            }

                            //update counter
                            updateCounter();

                            //check if editing is enabled
                            var preNodeOpen = editingEnabled ? "<pre contenteditable=\"true\">" : "<pre>";
                            //put the added pre text into another pre so we can modify it later on.
                            node.innerHTML = preNodeOpen + node.innerHTML + "</pre>";

                            //add hover buttons to every line
                            createhoverButtons(node);

                            //Scroll to item depending on setting
                            switch (scrollOnNewline) {
                                case "disabled":
                                    break;
                                case "toBottom":
                                    scrollToLast(1);
                                    break;
                                case "toTop":
                                    scrollToLast(0);
                                    break;
                                default:
                                    break;
                            }

                        } catch (e) {}

                    });
                });
            });

            //undo_button
            document.getElementById("undo_button").addEventListener("click", function() {
                historyPop();
            });

            //redo_button
            document.getElementById("redo_button").addEventListener("click", function() {
                historyPop_forward();
            });

            //edit_button
            document.getElementById("edit_button").addEventListener("click", function() {
                toggleEditing();
            });

            //pin_button
            document.getElementById("pin_button").addEventListener("click", function() {
                togglePinning();
            });

            //scroll_button
            document.getElementById("scroll_button").addEventListener("click", function() {
                switch (scrollOnNewline) {
                    case "disabled":
                        document.querySelector("#scroll_button").style.color = "";
                        document.querySelector("#scroll_button").innerText = "⇓";
                        scrollOnNewline = "toBottom";
                        break;
                    case "toBottom":
                        document.querySelector("#scroll_button").style.color = "";
                        document.querySelector("#scroll_button").innerText = "⇑";
                        scrollOnNewline = "toTop";
                        break;
                    case "toTop":
                        document.querySelector("#scroll_button").style.color = "#595959";
                        document.querySelector("#scroll_button").innerText = "⇕";
                        scrollOnNewline = "disabled";
                        break;
                    default:
                        scrollOnNewline = "toBottom";
                        break;
                }
                localStorage.setItem("scrollOnNewline", scrollOnNewline);
            });

            //Beginning of "remove last line" script.
            //Listen for click.
            document.getElementById("remove_button").addEventListener("click", function() {
                historyPush();

                //Check whether there are any lines.
                var remove_lines = document.querySelectorAll('#textlines > pre').length;
                if (remove_lines > 0) {

                    //Remove the first/last line.
                    switch (scrollOnNewline) {
                        case "disabled":
                            document.querySelector("#textlines > pre:last-of-type").remove();
                            break;
                        case "toBottom":
                            document.querySelector("#textlines > pre:last-of-type").remove();
                            break;
                        case "toTop":
                            document.querySelector("#textlines > pre:first-of-type").remove();
                            break;
                        default:
                            break;
                    }

                    updateCounter();
                };
            });

            //End of "remove last line"

            document.getElementById("clear_button").addEventListener("click", function() {
                historyPush();

                document.querySelectorAll('#textlines')[0].innerHTML = "";
                //Update the counter.
                updateCounter();
            });

            document.getElementById("go_to_last_button").addEventListener("click", function() {
                //document.querySelector("#textlines > pre:last-of-type").scrollIntoView();
                window.scroll(0, findPos(document.querySelector("#textlines > pre:last-of-type"))[1] - 200);
            });


            document.getElementById("go_bottom_button").addEventListener("click", function() {
                document.querySelectorAll("html")[0].scrollIntoView(false);
            });

            //VERTICAL MODE IS DISABLED
            //detect if the window width is low and make buttons vertical if it is
            //window.addEventListener("resize", checkWindowWidth);
            //check on page load as well.
            //checkWindowWidth();

            /*
            pre = document.createElement("pre");
            pre.innerHTML = "loremipsum\n\nloremipsumloremipsumloremipsum\n\n\n\nloremipsumloremipsum";
            document.querySelector("#textlines").append(pre);
            */

            //start mutation observer for new lines
            myMutationObserver.observe(document.querySelectorAll('#textlines')[0], {
                subtree: true,
                childList: true
            });

        });
        //---DOMContentLoaded end---
        //---DOMContentLoaded end---
        //---DOMContentLoaded end---



        //----------functions----------

        //add hover buttons to every line
        function createhoverButtons(element) {

            var hoverButtons = document.createElement("div");
            element.prepend(hoverButtons);
            hoverButtons.outerHTML = `<div class="hoverButtonsContainer">
<div class="hoverButtonsBackground">
<div class="hoverButtons hoverButtonDelete" title="Remove line">✖</div>
<div class="hoverButtons hoverButtonReduceNewlines" title="Reduce newlines and spaces">≡</div>
<div class="hoverButtons hoverButtonCopy" title="Copy to clipboard">📋</div>
<div class="hoverButtons hoverButtonDown" title="Scroll down one line">🡻</div>
<div class="hoverButtons hoverButtonUp" title="Scroll up one line">🡹</div>
</div>
</div>`;
            element.querySelector(".hoverButtonDelete").addEventListener("click", function(event) {
                historyPush();

                removeLine(event.target);
            });
            element.querySelector(".hoverButtonReduceNewlines").addEventListener("click", function(event) {
                historyPush();

                reduceNewlines(event.target);
            });
            element.querySelector(".hoverButtonUp").addEventListener("click", function(event) {
                scrollUpDown(event.target, event.clientY, true);
            });
            element.querySelector(".hoverButtonDown").addEventListener("click", function(event) {
                scrollUpDown(event.target, event.clientY, false);
            });
            element.querySelector(".hoverButtonCopy").addEventListener("click", function(event) {
                var range = document.createRange();
                range.selectNode(event.target.parentNode.parentNode.parentNode.querySelector("pre"));
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand("copy");
                window.getSelection().removeAllRanges();
            });
        }


        //start undo/redo buttons
        function historyPush(resetforward = true) {
            var textlinesNode = document.querySelector("#textlines").cloneNode(true);
            var dummyDiv = document.createElement("div");
            for (const element of textlinesNode.childNodes) {
                try {
                    if (element.firstChild.nodeName != "#text") {
                        let textPre = element.querySelector("pre");
                        //clean up contenteditable
                        textPre.removeAttribute("contenteditable");
                        dummyDiv.append(textPre);
                    }
                } catch {}
            }
            var historydict = {
                state: dummyDiv.innerHTML,
                linecount: textlinesNode.childNodes.length,
            }
            var historylength = historystack.push(historydict);
            if (historylength > maxhistorylength) {
                historystack.shift();
            }
            if (resetforward) {
                //reset forward history
                historystack_forward = [];
            }

            sethistoryButtons();
        }

        function historyPop() {

            historyPush_forward();
            popDict = historystack.pop();
            forgiveHistoryTimes = popDict.linecount;
            document.querySelector("#textlines").innerHTML = popDict.state;

            sethistoryButtons();
            updateCounter();
        }

        function historyPush_forward() {
            var textlinesNode = document.querySelector("#textlines").cloneNode(true);
            var dummyDiv = document.createElement("div");
            for (const element of textlinesNode.childNodes) {
                try {
                    //ignore text only nodes (that were just inserted)
                    if (element.firstChild.nodeName != "#text") {
                        let textPre = element.querySelector("pre");
                        //clean up contenteditable
                        textPre.removeAttribute("contenteditable");
                        dummyDiv.append(textPre);
                    }
                } catch {}
            }
            var historydict = {
                state: dummyDiv.innerHTML,
                linecount: textlinesNode.childNodes.length,
            }
            var historylength_forward = historystack_forward.push(historydict);
            if (historylength_forward > maxhistorylength) {
                historystack_forward.shift();
            }
        }

        function historyPop_forward() {

            historyPush(false);
            popDict = historystack_forward.pop();
            forgiveHistoryTimes = popDict.linecount;
            document.querySelector("#textlines").innerHTML = popDict.state;

            sethistoryButtons();
            updateCounter();
        }

        function sethistoryButtons() {
            if (historystack.length >= 1) {
                document.querySelector("#undo_button").removeAttribute("disabled");
            } else {
                document.querySelector("#undo_button").setAttribute("disabled", "");
            }
            if (historystack_forward.length >= 1) {
                document.querySelector("#redo_button").removeAttribute("disabled");
            } else {
                document.querySelector("#redo_button").setAttribute("disabled", "");
            }
        }
        //end undo/redo buttons

        //toggle editing
        function toggleEditing() {
            if (editingEnabled) {
                //disable editing, set button style
                const linesArray = document.querySelectorAll("#textlines>pre>pre").forEach(element => {
                    element.removeAttribute("contenteditable");
                });
                document.querySelector("#edit_button").classList.remove("edit_button_on");
                //also unpin if we pinned it
                if (editPinnedButtons) {
                    togglePinning();
                }
            } else {
                //push to history, enable editing, set button style
                historyPush();
                const linesArray = document.querySelectorAll("#textlines>pre>pre").forEach(element => {
                    element.setAttribute("contenteditable", "true");
                });
                document.querySelector("#edit_button").classList.add("edit_button_on");
                //also pin the buttons as well
                if (document.querySelectorAll(".pin_button_on").length != 1) {
                    togglePinning();
                    editPinnedButtons = true;
                }
            }
            editingEnabled = !editingEnabled;
        }

        //toggle pinning
        function togglePinning() {
            if (pinningEnabled) {
                document.querySelector("#toprightbuttons").removeAttribute("style");
                document.querySelector("#pin_button").classList.remove("pin_button_on");
                editPinnedButtons = false;
            } else {
                document.querySelector("#toprightbuttons").setAttribute("style", "display:inline-block;");
                document.querySelector("#pin_button").classList.add("pin_button_on");
            }
            pinningEnabled = !pinningEnabled;
        }

        //scrolling
        function scrollToLast(tolast) {
            if (tolast) {
                window.scroll(0, findPos(document.querySelector("#textlines > pre:last-of-type"))[1] - 280);
            } else {
                window.scroll(0, 0);
            }
        }

        function scrollUpDown(element, clientY, scrollUp) {
            //get the pre
            element = element.parentNode.parentNode.parentNode;
            var scrollto = null;
            try {
                if (scrollUp) {
                    scrollto = element.previousElementSibling;
                } else {
                    scrollto = element.nextElementSibling;
                }
                if (scrollto == null) {
                    if (scrollUp) {
                        document.querySelectorAll("html")[0].scrollIntoView(true);
                    } else {
                        document.querySelectorAll("html")[0].scrollIntoView(false);
                    }
                } else {
                    //fix scroll difference from reality
                    window.scroll(0, findPos(scrollto)[1] - clientY - scroll_fix_alignment);
                    //scrollto.scrollIntoView();
                }
                return;
            } catch (error) {}
        }

        //find an element's position in the whole page
        function findPos(obj) {
            var curleft = curtop = 0;
            if (obj.offsetParent) {
                do {
                    curleft += obj.offsetLeft;
                    curtop += obj.offsetTop;
                } while (obj = obj.offsetParent);
                values = [curleft, curtop];
                return values;
            }
        }

        function removeLine(element) {
            element = element.parentNode.parentNode.parentNode;
            element.remove();
            updateCounter();
        }

        function reduceNewlines(element) {
            element = element.parentNode.parentNode.parentNode;
            var modifystring = element.querySelector("pre").innerText;
            //trim newline+spaces at the start (once)
            modifystring = modifystring.replace(/^[\r\t\f\v 　\u00a0]*\n/, "");
            //trim spaces+newline at the end (once)
            modifystring = modifystring.replace(/[\r\t\f\v 　\u00a0]*\n$/, "");
            //clean spaces
            modifystring = modifystring.replace(/\n[\r\t\f\v 　\u00a0]*/gm, "\n");
            //reduce newlines (2->1, 1->0 etc...)
            modifystring = modifystring.replace(/(\n(\n+?))|(\n+?)/gm, "$2$3");
            element.querySelector("pre").innerText = modifystring;
        }

        function checkWindowWidth() {
            //VERTICAL MODE IS DISABLED
            let maxWidth = 390;
            let currentlyVertical = document.querySelectorAll(".verticalmode").length != 0;
            if (window.outerWidth < maxWidth && !currentlyVertical) {
                document.querySelector("#toprightbuttons").classList.add("verticalmode");
                document.querySelector("body").classList.add("verticalmode");
            } else if (currentlyVertical && window.outerWidth >= maxWidth) {
                document.querySelector("#toprightbuttons").classList.remove("verticalmode");
                document.querySelector("body").classList.remove("verticalmode");
            }
        }

        function updateCounter() {
            var charlength = 0;
            var linecount = 0;
            try {
                document.querySelectorAll("#textlines > pre").forEach(element => {
                    charlength += element.innerText.length;
                    linecount++;
                });
            } catch (error) {}
            document.querySelector("#counter").textContent = charlength + ' / ' + linecount;
            return;
        }

    </script>

    <!-- inserted pre tags go here -->
    <div id="textlines"></div>

    <div id="go_to_last_button" title="Scroll to the start of the last item">🡹</div>
</body>

</html>
